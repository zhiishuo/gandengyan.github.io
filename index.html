<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>干瞪眼 · 记分板 · Diamanté</title>

<!-- PWA 基本配置 -->
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0e1116">

<!-- iOS PWA 元标签 -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="记分板">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icons/icon-192.png">

<link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="titleRow">
      <h1>干瞪眼 · 记分板</h1>
      <span class="badgeMini">💣 <span class="mono" id="badgeMini">炸弹 0 ｜ 倍数 ×1</span></span>
    </div>
  </header>

  <div class="viewport">
    <div class="pages" id="pages">
      <!-- Page 0: 玩家 -->
      <section class="page" data-page="players">
        <div class="panel">
          <h2>玩家设置</h2>
          <div class="flex">
            <span class="pill">人数：<b id="playerCountEcho">7</b></span>
            <button class="btn" id="minusP">－1</button>
            <button class="btn" id="plusP">＋1</button>
          </div>
          <div class="flex" style="margin-top:8px">
            <label>设为：<input id="setP" class="mono num" value="7"></label>
            <button class="btn accent" id="applyP">应用人数</button>
          </div>
          <table style="margin-top:8px">
            <thead><tr><th>#</th><th>玩家名</th><th>分</th></tr></thead>
            <tbody id="playersBody"></tbody>
          </table>
          <div class="flex" style="margin-top:8px">
            <button class="btn accent" id="resetNames">重置名字</button>
            <button class="btn" id="zeroScores">分数清零</button>
          </div>
        </div>
      </section>

      <!-- Page 1: 记分 -->
      <section class="page" data-page="score">
        <div class="panel">
          <!-- 红色炸弹卡（仅加/减/重置） -->
          <div class="bombCard" id="bombCard">
            <div class="bombLabel">炸弹与倍数</div>
            <div class="bombValue mono" id="bombValue">炸弹 0 ｜ 倍数 ×1</div>
            <div class="bombBtns">
              <button class="btn" id="bombDec">－</button>
              <button class="btn" id="bombInc">＋</button>
              <button class="btn" id="bombReset">重置</button>
            </div>
          </div>

          <!-- 模式选择（赢家只通过下方按钮选择） -->
          <div class="flex" style="margin-top:12px">
            <label>模式
              <select id="mode">
                <option value="remain" selected>剩牌结算</option>
                <option value="winner1">胜者 +1</option>
                <option value="manual">手工输入</option>
              </select>
            </label>
          </div>

          <!-- 赢家：点名字选择（用于 remain 快速切换赢家） -->
          <div class="flex" id="winnerQuick" style="margin-top:8px"></div>

          <!-- 剩牌 / 春天（每行春天=单按钮） -->
          <div id="modeRemain" style="margin-top:8px">
            <table>
              <thead><tr><th>#</th><th>玩家</th><th>剩牌</th><th>春天</th></tr></thead>
              <tbody id="remainBody"></tbody>
            </table>
          </div>

          <!-- 胜者+1：在 winner1 模式下显示 -->
          <div id="modeWinner1" style="display:none; margin-top:8px">
            <div class="muted">点选本轮胜者：</div>
            <div id="winnerList" class="flex" style="gap:8px; flex-wrap:wrap; margin-top:6px"></div>
          </div>

          <!-- 手工输入 -->
          <div id="modeManual" style="display:none; margin-top:8px">
            <table>
              <thead><tr><th>#</th><th>玩家</th><th>分</th></tr></thead>
              <tbody id="manualBody"></tbody>
            </table>
          </div>

          <!-- 预览 + 入账 -->
          <div class="panel" style="margin-top:10px">
            <div class="flex" style="justify-content:space-between">
              <span class="muted">本轮预览（含倍数/春天）</span>
              <span class="pill">仅预览</span>
            </div>
            <div id="previewBox" class="mono" style="margin-top:6px; color:#fff5f5">—</div>
            <div id="winnerPot" class="mono" style="margin-top:6px; color:#ffdede"></div>

            <div class="flex" style="margin-top:10px; justify-content:flex-end">
              <button class="btn" id="undo">撤销</button>
              <button class="btn accent" id="commit_m">入账</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Page 2: 实时排名 -->
      <section class="page" data-page="rank">
        <div class="panel">
          <div class="rankHeader">
            <h2>实时排名</h2>
            <div class="sub" id="rankMeta">—</div>
          </div>
          <div class="rankList" id="rankList"></div>
        </div>
      </section>

      <!-- Page 3: 历史 -->
      <section class="page" data-page="history">
        <div class="panel">
          <h2>回合历史</h2>
          <table>
            <thead><tr><th>#</th><th>明细</th><th>操作</th></tr></thead>
            <tbody id="historyBody"></tbody>
          </table>
          <div class="flex" style="margin-top:8px">
            <button class="btn warn" id="clearHistory">清空历史</button>
            <button class="btn" id="exportCsv">导出 CSV</button>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- 记分页专属：停靠小计条 -->
  <div class="subtotalDock" id="subtotalDock" aria-live="polite">
    <div class="dockInner">
      <div>当前倍数：<b class="mono" id="dockMult">×1</b></div>
      <div>赢家预计进账：<b class="mono" id="dockPot">+0</b></div>
    </div>
  </div>

  <!-- 底部 Tab -->
  <nav class="tabbar">
    <button class="tabbtn" data-tab="players"><div class="ico">👥</div>玩家</button>
    <button class="tabbtn active" data-tab="score"><div class="ico">📝</div>记分</button>
    <button class="tabbtn" data-tab="rank"><div class="ico">🏆</div>排名</button>
    <button class="tabbtn" data-tab="history"><div class="ico">🗂️</div>历史</button>
  </nav>

  <!-- 入账成功提醒 -->
  <div class="toast" id="toast">✅ 入账成功</div>

  <script src="app.js" defer></script>

  <!-- 注册 Service Worker（HTTPS 或 localhost 生效） -->
  <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js');
  }
  </script>
</body>
</html>
